#!/usr/bin/env bash
set -euo pipefail

if [[ $# -lt 2 ]]; then
  echo "Usage: $0 <namespace> <resource_type>"
  echo "Example: $0 kube-system pods"
  exit 1
fi

NAMESPACE="$1"
RESOURCE_TYPE="$2"

echo "Resource, Namespace, Name, CPU, Memory"

kubectl top "$RESOURCE_TYPE" -n "$NAMESPACE" | tail -n +2 | while read -r line; do
  NAME=$(awk '{print $1}' <<< "$line")
  CPU=$(awk '{print $2}' <<< "$line")
  MEMORY=$(awk '{print $3}' <<< "$line")

  echo "$RESOURCE_TYPE, $NAMESPACE, $NAME, $CPU, $MEMORY"
done
